# 5UJ2 Debug Report

**Last Updated**: 2025-11-28  
**Status**: ‚è≥ Pending Investigation  
**Overall Match**: Unknown (residue missing)

---

## Summary

| Metric | Value | Target | Notes |
|--------|-------|--------|-------|
| Missing residues | 1 (residue 2) | 0 | Critical issue |
| Atoms for residue 2 | 0 | ~20+ | No atoms found |
| Frame for residue 2 | Missing | Present | Cannot calculate |

---

## Primary Issue

### Residue 2 Missing

**Problem**: Residue 2 has 0 atoms found, so no frame can be calculated.

**Impact**:
- Any pairs involving residue 2 will be missing
- May affect neighboring pair calculations
- Prevents accurate comparison with legacy

**Possible Causes**:
1. **PDB parsing error**: Residue 2 atoms not being read
2. **Residue numbering gap**: Residue 2 may not exist in PDB (starts at 3?)
3. **Alternative conformations**: Atoms may have altLoc that's being filtered
4. **HETATM issue**: Atoms may be labeled differently

---

## Investigation Plan

### Step 1: Examine PDB File

```bash
# Check for residue 2 in PDB
grep -E "^(ATOM|HETATM)" data/pdb/5UJ2.pdb | grep " 2 " | head -20

# Check residue numbering
grep -E "^(ATOM|HETATM)" data/pdb/5UJ2.pdb | awk '{print $5, $6}' | sort | uniq | head -20

# Check for altLoc issues
grep -E "^(ATOM|HETATM)" data/pdb/5UJ2.pdb | awk '{print $17}' | sort | uniq -c
```

### Step 2: Compare with Legacy

```bash
# Check legacy residue list
cat data/json_legacy/base_frame_calc/5UJ2.json | python3 -c "
import json, sys
d = json.load(sys.stdin)
frames = d.get('base_frame_calc', [])
for f in frames[:10]:
    print(f'Residue {f.get(\"residue_index\")}: {f.get(\"residue_name\")}')"
```

### Step 3: Debug Residue Parsing

```bash
# Check modern residue indices
./build/check_residue_indices data/pdb/5UJ2.pdb

# Compare with legacy
python3 scripts/compare_json.py compare 5UJ2 --verbose
```

---

## Hypotheses

### H1: Residue 2 Doesn't Exist

The PDB may start numbering at residue 1, then jump to 3.
- Common in X-ray structures with missing density
- Legacy may handle gaps differently

**Test**: Check residue numbers in PDB header and atoms

### H2: Alternative Conformations

Residue 2 atoms may have altLoc = 'B' only.
- Modern may be filtering for altLoc = 'A' or ' '
- Legacy may include all altLocs

**Test**: Check altLoc column for residue 2 atoms

### H3: Different Chain

Residue 2 may be in a different chain than expected.
- Chain handling may differ between legacy and modern

**Test**: Check chain IDs for early residues

---

## Data to Collect

- [ ] Does residue 2 exist in PDB file?
- [ ] What are the first few residue numbers?
- [ ] Are there alternative conformations?
- [ ] What chain is residue 2 in?
- [ ] How many atoms should residue 2 have?
- [ ] What does legacy JSON show for residue 2?

---

## Potential Fixes

Depending on root cause:

1. **Missing residue**: Update code to handle gaps gracefully
2. **AltLoc filtering**: Adjust to include all conformations (or pick best)
3. **Chain handling**: Fix chain ID parsing
4. **Numbering offset**: Adjust residue index mapping

---

## Related Documentation

- [RESIDUE_INDEXING_ISSUE.md](../RESIDUE_INDEXING_ISSUE.md) - Residue indexing details
- [PDB_PROPERTIES_MATCHING_APPROACH.md](../PDB_PROPERTIES_MATCHING_APPROACH.md) - PDB matching

---

## Investigation Log

### 2025-11-28
- Created this debug report
- Issue known but not yet investigated
- Blocked behind 6CAQ investigation

---

## Next Steps

1. **Wait for 6CAQ completion** (higher priority)
2. **Examine PDB file** for residue 2
3. **Identify root cause** of missing atoms
4. **Implement fix**
5. **Re-run comparison**

---

*Debug report for 5UJ2 - pending investigation of missing residue 2.*

